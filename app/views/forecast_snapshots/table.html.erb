<p id="notice"><%= notice %></p>

<%= link_to 'Charts', forecast_snapshot_path(@forecast_snapshot) %> |
<% if current_user.internal_user? %>
  <%= link_to 'Edit', edit_forecast_snapshot_path(@forecast_snapshot) %> |
<% end %>
<%= link_to 'Back', forecast_snapshots_path %>

<h2 class="snapshot-table-title"><%= @forecast_snapshot.name+' ('+@forecast_snapshot.version+')' %></h2>
<p>Last update: <%= @forecast_snapshot.updated_at.strftime('%m/%d/%Y') %></p>

<table class="snapshot-table">
  <tr>
    <th class="header-col"> &nbsp; </th>
    <% quarterly = @all_dates.any? {|s| (s.include? '-04-') || (s.include? '-07-') || (s.include? '-10-')} %>
    <% @all_dates.each do |date| %>
        <th>
        <%= quarterly ? date[0, 4] + 'Q' + (date[5, 2].to_i / 3 + 1).to_s : date[0, 4] %>
        </th>
    <% end %>
  </tr>
  <% @tsd_files[0].get_all_series.each do |s| %>
      <% precision = (s[:udaman_series].decimals || 1) rescue 1 %>
    <tr>
      <%
        fullname = Series.build_name_two(s[:name], s[:frequency])
        display_name = @forecast_snapshot.retrieve_name(fullname) + ' (' + fullname + ')'
      %>
      <td class="header-col series-title" title="<%= display_name %>"><%= display_name %></td>
      <% @all_dates.each do |date| %>
        <td class="series-data"><%= s[:data_hash][date].nil? ? '' : number_with_precision(s[:data_hash][date], precision: precision, separator: '.', delimiter: ',') %></td>
      <% end %>
    </tr>
    <tr>
       <td class="header-col change"> &nbsp; % Change</td>
      <% @all_dates.each do |date| %>
          <td class="change-data"><%= s[:yoy_hash][date].nil? ? '' : number_with_precision(s[:yoy_hash][date], precision: precision, separator: '.', delimiter: ',') %></td>
      <% end %>
    </tr>
  <% end %>
</table>

<div class="table-note">
  <p>Note: <%= @forecast_snapshot[:comments].to_s %></p>
</div>
