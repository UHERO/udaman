<table style="border-collapse:collapse;">
	<% series.loaders_sort_for_display.each do |ld| %>
    <% myeval = ld.eval.to_s %>
    <% if ld.disabled?  ## I dislike having this as a separate code path, but... it's just cleaner %>
      <tr style="border:none;background-color:lightgrey;" >
        <td style="border:none;">
          <strong><%= ld.id %></strong>
          <% if current_user.admin_user? %>
             <%= link_to 'clear', { controller: :loaders, action: :clear, id: ld.id } %> |
             <%= link_to 'edit', { controller: :loaders, action: :edit, id: ld.id } %> |
             <%= link_to 'delete', { controller: :loaders, action: :delete, id: ld.id },
                                  data: { :confirm => "Permanently delete disabled definition #{ld.id}: Are you sure??" } %>
          <% end %>
        </td>
      </tr>
      <tr style="border:none;background-color:lightgrey;" >
      <td style="border:none;"><%= raw myeval[0..70] + (myeval[71] ? '....' : '') %></td></tr>
      <% next %>
    <% end %>

  	<tr style="border:none;background-color:#<%= ld.color %>;" >
  		<td style="border:none;">
      <%= ld.last_run ? ld.last_run.strftime("%m/%d/%y") : '-' %>
      <span style="color:gray"><%= ld.last_run ? ld.last_run.strftime("%H:%M") : '-' %></span>&nbsp;(<%= ld.priority %>)
 					<%= 
						link_to 'load', {
							:controller => 'loaders',
							:action => 'source', 
							:id => ld.id} unless myeval.blank?
					%><% if current_user.admin_user? %>&nbsp;|&nbsp;<%=
                link_to 'clear', {
                  :controller => 'loaders',
                  :action => 'clear',
                  :id => ld.id} unless myeval.blank?
              %> |&nbsp;<%= link_to 'delete', {
                    :controller => 'loaders',
                    :action => 'delete',
                    :id => ld.id },
                    data: { :confirm => "Delete definition #{ld.id}: Are you sure??" } %>
               | <%= link_to 'disable', { controller: :loaders, action: :disable, id: ld.id },
                         data: { confirm: "Disable definition #{ld.id}: Can only be restored by system admin. Are you sure??" } %> |
              <% if myeval =~ /load_from_download|load_from_file/ %>
                 <%= link_to 'reset', { controller: :loaders, action: :reset, id: ld.id }%>&nbsp;|
              <% end %>
              <%= link_to 'edit', { controller: :loaders, action: :edit, id: ld.id } %> |
              <%= link_to 'toggle nightly load', { controller: :loaders, action: :toggle_reload_nightly, id: ld.id} %>
            <% else %>
              <span style="color:gray"> | clear | delete | disable | edit | toggle nightly load</span> <!-- fake controls to maintain uniform appearance -->
            <% end %>
          <% if ld.runtime %>
              <span style="color:gray">(<%= "#{ld.runtime.round(2)}s" %>)</span>
          <% end %>
        <% if ld.last_error %>
          <br/><span class='error_message'><%= raw text_with_linked_download(ld.last_error) %></span>
        <% end %>
  		</td>
    </tr>
    <tr style="border:none;background-color:#<%= ld.color %>;" >
    <td style="border:none;">
       <h3><%= ld.id %>
           <% if ld.loader_type == :pseudo_history %> (pseudo-history*)<% end %>
           <% if ld.reload_nightly? %> <i class="fas fa-clock" aria-hidden="true"></i><% end %>
       </h3>
      <p>
			<% if ld.scale != '1.0' %>
				<span style="background-color:pink;"> <strong>Scale:</strong> <%= ld.scale %><% if ld.loader_type == :other %>&Dagger;<% end %>&nbsp;</span><br/>
			<% end %>
      <% if ld.presave_hook %>
           <strong>Presave hook:</strong> <%= ld.presave_hook %><br/>
      <% end %>
			<%= raw text_with_linked_words(ld.description) %><br/>
      <%= raw text_with_linked_download(myeval) %>
      </p>
		</td>
	</tr>      
	<% end %>
</table>
